#!/usr/bin/env python3
#
# Print the Common Vulnerabilities and Exposures CVE numbers for a given package
# Example 1: 
#   cvels bash 
# prints all CVEs related to bash  
# Example 2:
#   cvels perl:5.8.6     
# prints all CVEs related to Perl 5.8.6
#
import sys
import nvdlib

def fullname(name):
    exceptions = { "perl":"perl:perl", "zsh":"zsh", "openssl": "openssl", "git": "git" }

    if ":" in name:
        chunks = name.split(":")
        prefix = chunks[0]
        suffix = ":" + chunks[1]
    else:
        prefix = name
        suffix = ''

    if prefix in exceptions:
        return exceptions[prefix] + suffix
    else:
        return f"gnu:{name}"

for arg in sys.argv[1:len(sys.argv)]:
    full_name = fullname(arg)
    r = nvdlib.searchCPE(cpeMatchString = f'cpe:2.3:a:{full_name}:', cves=True)
    for eachCPE in r:
        for eachVuln in eachCPE.vulnerabilities:
            print(eachVuln)
